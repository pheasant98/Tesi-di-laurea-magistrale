\chapter{Appendice A}

\section{Codice di adattamento dataset per il trasferimento dati}

Nella Figura \ref{sec:a1} viene mostrato il codice applicato per adeguare il dataset con le modifiche scritte precedentemente.\\
Tale codice ha l'obbiettivo di prendere le due righe di ogni partita e di unirle insieme formando un unica riga per ogni partita. Successivamente si elimineranno le righe delle partite giocate fuori casa (\textsf{AtHome} = FALSE) dalle squadre indicate in \textsf{Team} mentre le righe delle partite giocate in casa (\textsf{AtHome} = TRUE) dalle squadre indicate in \textsf{Team} conteranno il risultato della fusione.\\
Perciò si è creato un vettore vuoto per ogni covariata presente nel dataset, ad eccezione di \textsf{AtHome} che verrà gestita in un modo diverso. Il vettore \texttt{del} è il vettore che tiene traccia di quali righe saranno da eliminare. \texttt{k} è l'indice usato per scorre il dataset per trovare i dati dell'avversario; \texttt{z} l'indice usato per inserire un nuovo elemento nel vettore \texttt{del}.\\
Il primo ciclo \texttt{for} scorre tutto il dataset alla ricerca delle righe con i dati delle partite giocate in casa dalla squadra indicata in \texttt{Team}, infatti al suo interno il primo costrutto \texttt{if} controlla se la partita è in casa per \texttt{Team} se sì, parte un secondo ciclo \texttt{for} che anche esso scorre tutto il dataset per cercare la riga con la partita giocata della squadra indicata in \texttt{Vs}; giocata ovviamente fuori casa. Perciò all'interno del secondo ciclo \texttt{for} c'è un costrutto \texttt{if} che controlla se la j-esima riga si riferisce alla stessa partita indicata nella i-esima riga, se sì allora si salvano tutti i dati nei vettori e si incrementa l'indice \texttt{k}. Se il primo \texttt{if} da esito negativo allora si andrà a inserire l'indice dell'i-esima riga nel vettore \texttt{del} perché contiene informazioni di una partita giocata fuori casa dalla squadra indicata in \textsf{Team} e viene incrementato l'indice di uno \texttt{z}.\\

\begin{lstlisting}[language=R, caption{Codice di adattamento dataset per il trasferimento dati}, captionpos=b, label=sec:a1]
PossVs <- c()
ShVs <- c()
ShTVs <- c()
G.ShVs <- c()
PAttVs <- c()
PCmp.Vs <- c()
SPAttVs <- c()
SPCmp.Vs <- c()
MPAttVs <- c()
MPCmp.Vs <- c()
LPAttVs <- c()
LPCmp.Vs <- c()
ToDef3rdVs <- c()
ToMid3rdVs <- c()
ToAtt3rdVs <- c()
ToAttPenVs <- c()
ToDistVs <- c()
FlsVs <- c()
FldVs <- c()
CrsVs <- c()
IntVs <- c()
TklWinVs <- c()
RecovVs <- c()
del <-c()
k <- 1
z <- 1
for(i in 1:nrow(soccern)){
	if(soccern$AtHome[i] == TRUE){
		for(j in 1:nrow(soccern)){
			if((soccern$Team[j] == soccern$Vs[i]) && (soccern$Team[i] == soccern$Vs[j]) && (soccern$AtHome[j] == FALSE)){
				PossVs[k] <- soccern$Poss[j]
				ShVs[k] <- soccern$Sh[j]
				ShTVs[k] <- soccern$SoT[j]
				G.ShVs[k] <- soccern$G.Sh[j]
				PAttVs[k] <- soccern$PAtt[j]
				PCmp.Vs[k] <- soccern$PCmp.[j]
				SPAttVs[k] <- soccern$SPAtt[j]
				SPCmp.Vs[k] <- soccern$SPCmp.[j]
				MPAttVs[k] <- soccern$MPAtt[j]
				MPCmp.Vs[k] <- soccern$MPCmp.[j]
				LPAttVs[k] <- soccern$LPAtt[j]
				LPCmp.Vs[k] <- soccern$LPCmp.[j]
				ToDef3rdVs[k] <- soccern$ToDef3rd[j]
				ToMid3rdVs[k] <- soccern$ToMid3rd[j]
				ToAtt3rdVs[k] <- soccern$ToAtt3rd[j]
				ToAttPenVs[k] <- soccern$ToAttPen[j]
				ToDistVs[k] <- soccern$TotDist[j]
				FlsVs[k] <- soccern$Fls[j]
				FldVs[k] <- soccern$Fld[j]
				CrsVs[k] <- soccern$Crs[j]
				IntVs[k] <- soccern$Int[j]
				TklWinVs[k] <- soccern$TklWin[j]
				RecovVs[k] <- soccern$Recov[j]
				k <- k + 1
			}      
		}
	}
	else{
		del[z] <- i
		z <- z + 1
	}
}
\end{lstlisting}
\bigskip
Di seguito vengono riportati i comandi fatti per applicare le modifiche al dataset.
\bigskip
\begin{lstlisting}[language=R]
	> soccern3 <- soccern2[-del,]
\end{lstlisting}
\bigskip
Con il precedente comando si va a creare un nuovo dataset con 380 righe, eliminando tutte quelle righe con valore \texttt{FALSE} su \textsf{AtHome}. \\

Con il comando mostrato nella Figura \ref{sec:a2} si va a modificare \textsf{Team} rendendolo un \texttt{data.frame}, andando a inserire i dati della riga relativi alla squadra che gioca in casa. Si inserisce come chiave \texttt{team = soccern3\$Team} e si indica che la partita è in casa per la squadra di riferimento con \texttt{at.home = 1}.\\

\begin{lstlisting}[language=R, caption={Codice per la creazione del data.frame Team}, label=sec:a2] 
	> soccern3$Team <- data.frame(team = soccern3$Team, GF = soccern3$GF, GA = soccern3$GA,  at.home = 1, Poss = soccern3$Poss, Sh = soccern3$Sh, SoT = soccern3$SoT, G.Sh = soccern3$G.Sh, PAtt = soccern3$PAtt, PCmp. = soccern3$PCmp., SPAtt = soccern3$SPAtt, SPCmp. = soccern3$SPCmp., MPAtt = soccern3$MPAtt, MPCmp. = soccern3$MPCmp., LPAtt = soccern3$LPAtt, LPCmp. = soccern3$LPCmp., ToDef3rd = soccern3$ToDef3rd, ToAtt3rd = soccern3$ToAtt3rd, ToAttPen = soccern3$ToAttPen, TotDist = soccern3$TotDist, Fls = soccern3$Fls, Fld = soccern3$Fld, Crs = soccern3$Crs, Int = soccern3$Int, TklWin = soccern3$TklWin, Recov = soccern3$Recov)
\end{lstlisting}
\bigskip

Con il comando mostrato nella Figura \ref{sec:a3} si va a modificare \textsf{Vs} rendendolo un \texttt{data.frame}, andando a inserire i dati della riga relativi alla squadra che gioca fuori casa. Si inserisce come chiave \texttt{team = soccern3\$Vs} e si indica che la partita è fuori casa per la squadra \texttt{Vs} con \texttt{at.home = 0}.\\ Per quanto riguarda il resto dei dati, vengono riportati attraverso l'inserimento dei vettori costruiti e riempiti precedentemente.\\

\begin{lstlisting}[language=R, caption={Codice per la creazione del data.frame Vs}, captionpos=b, label=sec:a3]
	> soccern3$Vs <- data.frame(team = soccern3$Vs, GF = GFVs, GA = GAVs, at.home = 0, Poss = PossVs, Sh = ShVs, SoT = ShTVs, G.Sh = G.ShVs, PAtt = PAttVs, PCmp. = PCmp.Vs, SPAtt = SPAttVs, SPCmp. = SPCmp.Vs, MPAtt = MPAttVs, MPCmp. = MPCmp.Vs, LPAtt = LPAttVs, LPCmp. = LPCmp.Vs, ToDef3rd = ToDef3rdVs, ToAtt3rd = ToAtt3rdVs, ToAttPen = ToAttPenVs, TotDist = ToDistVs, Fls = FlsVs, Fld = FldVs, Crs = CrsVs, Int = IntVs, TklWin = TklWinVs, Recov = RecovVs)
\end{lstlisting}
