% !TEX encoding = UTF-8
% !TEX TS-program = pdflatex
% !TEX root = ../tesi.tex
%**************************************************************
\chapter{Modeling Paired Comparisons}
%\label{cap:archittettura del sistema AWMS}
%**************************************************************

\intro{Nel seguente capitolo verranno introdotti differenti modelli per la \textit{paired comparisons}, iniziando con il Bradley-Terry model versione standard fino a presentare tutte le sue estensioni usate per l'analisi trattata. }
TO DO

\section{Basic Bradley-Terry Model}
Il Bradley-Terry model \autocite{bradley1952rank} asserisce che in una competizione tra due qualsiasi giocatori, detti player $\alpha_{i}$ e player $\alpha_{j}$ con i,j $\in$ \{1,...,n\}, la probabilità che $\alpha_{i}$ sia preferito a $\alpha_{j}$ è data dal rapporto tra i parametri abilità/forza dei giocatori, detti $\gamma_{i}$ e $\gamma_{j}$. Il modello standard non considera covariate e in generale, non presta alcuna attenzione all'eterogeneità causata dai soggetti dei confronti.\\

%Formalmente, sia Y$_{i,j}$ la variabile casuale associata al risultato della \emph{paired comparison} tra set di oggetti, con \textit{j} > \textit{i} $\in$ \{1,...,n\}, dove nella forma più semplice, il modello dato è il seguente:

Formalmente, sia un set di oggetti \{$\alpha_{1},....,\alpha_{n}$\}, il modello Bradley-Terry nella sua forma standard (binaria) è il seguente: 
\begin{align} 
	P(\alpha_{i} \succ \alpha_{j}) = P(Y_{i,j} = 1) = \frac{exp(\gamma_{i} - \gamma_{j})}{1 + exp(\gamma_{i} - \gamma_{j})} \label{for:3.1} 
\end{align}
%con \textit{j} > \textit{i} $\in$ \{1,...,n\}

Il modello può essere alternativamente espresso in forma di logit lineare:

\begin{align}
		logit(\alpha_{i} \succ \alpha_{j}) =  log( \frac{P( \alpha_{i} \succ \alpha_{j})}{P( \alpha_{j} \succ \alpha_{i})} ) = log(\frac{exp(\gamma_{i})}{exp(\gamma_{j})}) = \gamma_i - \gamma_j 
\end{align}

La risposta del modello rappresenta la probabilità che un certo oggetto $\alpha_{i}$ è preferito rispetto ad un altro oggetto $\alpha_{j}$, $i \succ j$.
Y$_{i,j}$ è la variabile casuale associata al risultato della \emph{paired comparison}, dove Y$_{i,j}$ = 1 se l'oggetto $\alpha_{i}$ è preferito all'oggetto $\alpha_{j}$ e Y$_{i,j}$ = 0 viceversa. I parametri $\gamma_{i}$ $\in$ \{1, ..., n\} rappresentano l'abilità o la forza del loro corrispondente oggetto, stimati dal modello attraverso la massima verosimiglianza. È infine necessario un vincolo per identificare gli oggetti, ad esempio il vincolo di somma $ \sum_{i=1}^{n} \gamma_{i} = 0 $ oppure il vincolo dell'oggetto di riferimento, $\gamma_{i} = 0$ per un oggetto $\alpha_{i}$ $\in$ \{1, ..., n\}. Se il vincolo dell'oggetto di riferimento è usato, allora il valore dei parametri abilità degli altri oggetti $\alpha_{j}$ sarà la differenza rispetto all'oggetto di riferimento $\alpha_{i}$.
Il modello precedentemente descritto è chiamato modello non strutturato.\\


\section{Bradley-Terry Model con ordered response categories}	
In molti contesti di comparazione tra oggetti, è possibile che sia richiesto di dare una scala di preferenza tra un oggetto e un altro. Supponiamo che due oggetti $\alpha_{i}$ e $\alpha_{j}$ siano confrontati e che la preferenza ora non sia più espressa i termini di: preferisco $\alpha_{i}$ al posto di $\alpha_{j}$ o viceversa ma, attraverso una scala di preferenza, ad esempio dando una forte preferenza a $\alpha_{i}$ rispetto a $\alpha_{j}$ o una leggera preferenza a $\alpha_{i}$ rispetto a $\alpha_{j}$ o non dando nessuna preferenza o preferendo leggermente $\alpha_{j}$ rispetto a $\alpha_{i}$ oppure preferire fortemente $\alpha_{j}$ rispetto a $\alpha_{i}$. Quindi dal modello descritto nella precedente sezione si passa da due classi di preferenza a cinque classi di preferenza.\\
Ovviamente il caso descritto è di interesse per le comparazioni calcistiche dato che non è sufficiente stimare la probabilità di vittoria o sconfitta ma deve essere obbligantemente preso in considerazione anche il pareggio come risultato.\\

Modelli che consentono un numero generale di categorie K, sono stati proposti da \autocite{tutz1986bradley} e da \autocite{bradley1952rank}, in particolare quest'ultimo mostrò come due modelli per l'analisi di dati ordinati possono essere adattati per le \emph{ordinal paired comparisons}.\\

Il primo modello è il \emph{cumulative link model} e sfrutta la rappresentazione della variabile casuale latente. In generale, sia H il numero di gradi della scala di preferenza e sia $Z_{i,j}$ una variabile continua casuale latente e siano $\theta_{1} $ < $\theta_{2}$ < .... < $\theta_{H-1}$ le soglie tale che Y$_{i,j} = h$ quando $\theta_{h-1} < Z_{i,j} < \theta_{h}$. Allora:
\begin{align}
	P(Y_{i,j}\leq h) =  \frac{exp(\theta_{h} + \gamma_{i} - \gamma_{j})}{1 + exp(\theta_{h} + \gamma_{i} - \gamma_{j})} \label{for:3.2.1}
\end{align}

con h $\in$ \{1,....,H\} che indica le possibili \emph{response categories}. I parametri $\theta_{h}$ rappresentano le cosiddette soglie per le singole \emph{response categories}, che determinano la preferenza per le specifiche categorie. In particolare, Y$_{i,j} = 1$ rappresenta la massima preferenza per un oggetto \textit{i} rispetto a un oggetto \textit{j}.\\
In generale vi è imposta una simmetria del modello in modo che valga: $P(Y_{i,j} = h) = P(Y_{j,i} = H - h + 1)$. È quindi necessario che le soglie siano ristrette a $\theta_{i}$ = -$\theta_{H-h}$ e se, H è dispari, $\theta_{H/2}$ = 0; per garantire che le probabilità siano simmetriche. Per garantire che le probabilità siano non negative per le singole \emph{response categories} vi è imposta la seguente limitazione: $-\infty$ = $\theta_{0} < \theta_{1} < ... < \theta_{H-1} < \theta_{H} = \infty$. Dato che la soglia per l'ultima categoria è fissata a $\theta_{H} = \infty$ allora vale che $P(Y_{i,j} \leq H)$ = 1. Si sottolinea che le soglie sono parametri che vanno stimate dai dati; inoltre la probabilità di una singola \emph{response category} può essere derivata dalla differenza tra categorie adiacenti cioè:
\begin{center}
	  $P(Y_{i,j} = k)$ = $P(Y_{i,j} \leq k)$ - $P(Y_{i,j} \leq k - 1)$
\end{center}

Il modello delle \emph{adjacent categories model}, così come il modello Bradley-Terry, ha anche una rappresentazione logit lineare ed è il seguente:
\begin{align}
	logit(Y_{i,j}\leq h) =  \theta_{h} + \gamma_i - \gamma_j 
\end{align}

Il secondo modello invece proposto da \autocite{agresti1992analysis} è il \emph{adjacent categories model}. In questo caso il collegamento è applicato alle probabilità di risposte adiacenti piuttosto che alle probabilità cumulative, riducendosi così al modello Bradley-Terry quando sono consentite solo due categorie e al modello proposto da \autocite{davidson1970extending} quando sono consentite solo tre categorie.\\
Il \emph{adjacent categories model} è più semplice da interpretare rispetto ai \emph{cumulative link models} poiché l'odds ratio si riferisce a un determinato risultato anziché a raggruppamenti di risultati. \\
Perciò dal modello proposto da \autocite{davidson1970extending}, sia $\theta$ il parametro stimato dai dati che indica quanto è auspicabile la non preferenza, nel nostro caso il pareggio, allora:

\begin{align}
	P(Y_{i,j} = 2 | Y_{i,j} \not = 0) =  \frac{exp(\gamma_{i} - \gamma_{j})}{1 + exp(\gamma_{i} - \gamma_{j})}, \label{for:4.5}
\end{align}
	
\begin{align}
	P(Y_{i,j} = 1) =  \frac{\theta \sqrt{exp(\gamma_{i}) * exp(\gamma_{j})}}{exp(\gamma_{i}) + exp(\gamma_{j}) + \theta\sqrt{exp(\gamma_{i}) * exp(\gamma_{j})}}, 
\end{align}

\begin{align}	
	P(Y_{i,j} = 0 | Y_{i,j} \not = 1) =  \frac{exp(\gamma_{j} - \gamma_{i})}{1 + exp(\gamma_{j} - \gamma_{i})}\label{for:4.7}
\end{align}

Si è riportato la modellazione di tutti e tre i possibili risultati, con $\gamma_{n}$ che rappresenta la forza degli oggetti in comparazione da stimare dai dati. La modellazione della vittoria \hyperref[for:4.5]{(4.5)} e della sconfitta \hyperref[for:4.7]{(4.7)} dell'oggetto $\alpha_{i}$ contro l'oggetto $\alpha_{j}$ rimane uguale alla modellazione \hyperref[for:3.1]{(4.2)} descritta precedentemente. Diversamente per il pareggio dove viene aggiunto il parametro $\theta$. \\

\section{Bradley–Terry Model con order effects} \label{sez:4.3}
Nel modello descritto nella sezione 4.2, si era scritto che, era necessario imporre la simmetria tra le categorie di risposta. Purtroppo la simmetria imposta risulta essere non adeguata in alcuni contesti, tra questi vi è anche il calcio; poiché l'ordine dei oggetti conta. Infatti in una partita di calcio, la prima squadra che viene indicata tra le due squadre, è quella che gioca in casa, dove teoricamente dovrebbe avere un vantaggio sull'avversario. Perciò, il presupposto che le categorie di risposta siano simmetriche non vale più. \\
Un possibile modello riadattato al problema esposto è il seguente:

\begin{align} 
	P(\alpha_{i}\succ \alpha_{j}) = P(Y_{i,j} = 1) = \frac{exp(\delta + \gamma_{i} - \gamma_{j})}{1 + exp(\delta + \gamma_{i} - \gamma_{j})} \label{for:3.8} 
\end{align}

Il qual'è il modello \hyperref[for:3.1]{(4.1)} riadatto e da cui possiamo derivare il modello \hyperref[for:3.2.1]{(4.3)} riadatto che è il seguente:

\begin{align}
	P(Y_{i,j}\leq h) =  \frac{exp(\delta + \theta_{h} + \gamma_{i} - \gamma_{j})}{1 + exp(\delta + \theta_{h} + \gamma_{i} - \gamma_{j})} \label{for:3.9}
\end{align}

L'\emph{order effect} (il vantaggio di giocare in caso in ambito calcistico); viene trattato come una variabile $\delta$. Se $\delta$ > 0 allora viene attribuito un vantaggio all'oggetto $\alpha_{i}$; aumentando la probabilità che vinca il confronto o nel caso di \emph{ordered response categories}, di avere un risultato superiore rispetto all'oggetto $\alpha_{j}$. Chiaramente il peso di $\delta$ deve essere stimato dai dati.\\

Il modello \hyperref[for:3.8]{(4.8)} cosi come il modello \hyperref[for:3.9]{(4.9)} , hanno anche una rappresentazione logit lineare e sono le seguenti:\\

Per \hyperref[for:3.8]{(3.8)}

\begin{align}
	logit(\alpha_{i} \succ \alpha_{j}) =  \delta + \gamma_i - \gamma_j 
\end{align}

Per \hyperref[for:3.9]{(3.9)}

\begin{align}
	logit(\alpha_{i} \succ \alpha_{j}) =  \delta + \theta_{h} + \gamma_i - \gamma_j 
\end{align}
	
\section{Bradley–Terry Model con variabili esplicative}
Fin ad ora è stato presentato un modello che valutasse il grado di preferenza per un oggetto $\alpha_{i}$ rispetto a un oggetto $\alpha_{j}$, senza che considerasse nessuna covariata. Chiaramente tale modello risulta essere inutile per le nostre analisi, dato che siamo interessati a capire quali variabili possono influenzare il risultato della comparazione. Prima di esporre il modello adatto all'analisi è necessario fare una distinzione tra soggetti e oggetti e successivamente distinguere i tre tipi di covariate in una \emph{paired comparison} ovvero le \emph{subject-specific} $x_p$, le \emph{object-specific} $z_i$ e le \emph{subject-object-specific} $z_pi$ per i soggetti \emph{p}, \emph{p} = 1,.....,m e gli oggetti $\alpha_{i}$, \emph{i} = 1,....,n.\\
Gli oggetti sono le entità che vengono confrontate in una \emph{paired comparison}. I soggetti invece, sono le unità che stabiliscono la preferenza tra gli oggetti in una \emph{paired comparison}. Nel calcio gli oggetti sono le squadre di calcio, mentre i soggetti sono le partite di calcio dove avviene la comparazione tra le squadre.\\

Di seguito vengono illustrate le tre tipologie di covariate in una \emph{paired comparison}:
\begin{itemize}
	\item \texttt{subject-specific}: Caratterizzano i soggetti che eseguono i confronti tra oggetti, e quindi queste covariate variano solo tra soggetti. Ad esempio nel calcio una partita di calcio è un soggetto e covariate come il numero spettatori o il meteo sono di tipo \emph{subject-specific}. Per poter includere le covariate \emph{subject-specific}, l'abilità $\gamma_{pi}$ dell'oggetto $\alpha_{i}$ nel soggetto p sarà nella forma 
	\begin{center}
		$ \gamma_{pi}$ = $\beta_{i0} + x^{T}_{p}\beta_i$
	\end{center}
	dove $x_p$ è un vettore di covariate di tipo \emph{subject-specific}. $\beta_i$ è il peso stimato delle covariate per ogni oggetto $\alpha_{i}$. Il parametro $\beta_{iz}$ rappresenta l'aumento dell'abilità dell'oggetto $\alpha_{i}$ se la z-esima variabile aumenta di un'unità. Con l'inclusione di covariate \emph{subject-specific} nel modello, esso è in grado di spiegare l'eterogeneità sui soggetti. Le covariate \emph{subject-specific} nelle \emph{paired comparisons} sono state considerate prima da \autocite{Turner2012Firth} e poi da \autocite{Francis2010}.
	\item \texttt{object-specific}: Caratterizzano gli oggetti che vengono confrontati ma, non variano tra i soggetti ma tra gli oggetti. Nel calcio una covariata di tipo \emph{object-specific} può essere il valore di mercato della rosa della squadra di calcio (l'oggetto della comparazione). Un loro utilizzo lo si può trovare in \autocite{TutzSchauberger2015}.
	Per poter includere le covariate \emph{object-specific}, l'abilità $\gamma_{i}$ dell'oggetto $\alpha_{i}$ sarà nella forma 
	\begin{center}
		$\gamma_{pi}$ = $ \gamma_{i}$ = $\beta_{i0} + z^{T}_{i}\tau$
	\end{center}
	dove $z_{i}$ è un vettore di covariate di tipo \emph{object-specific}. Il peso $\tau$ è un parametro globale, che insieme a $z_{i}$ rappresenta l'abilità spiegata delle covariate mentre $\beta_{i0}$ rappresenta la parte dell'abilità non spiegata dalle covariate. 
	\item \texttt{subject-object-specific}: Queste tipi di covariate possono variare sia per oggetti e sia per i soggetti, ad esempio nel calcio il possesso palla è una covariata che varia per ogni singola squadra e per ogni singola partita. Tali variabili vengono approfondite da \autocite{ThunerEymann2000} e da \autocite{MauererPossneckerThurnerTutz2015}. Gli effetti delle covariate di tipo \emph{subject-object-specific} possono essere modellati nella seguente forma
		\begin{center}
		$ \gamma_{pi}$ = $\beta_{i0} + z^{T}_{pi}\eta_i$
	\end{center}
		dove $z_pi$ è un vettore di covariate e $\eta_i$ è il peso stimato delle covariate per ogni oggetto. Contrariamente alle coviariate di tipo \emph{subject-specific}, le covariate di tipo \emph{subject-object-specific} posso essere modellate con un effetto globale, quindi vale la forma 
		\begin{center}
			$ \gamma_{pi}$ = $\beta_{i0} + z^{T}_{pi}\tau$
		\end{center}
	 dove $\tau$ rappresenta il peso stimato delle covariate. Come si può notare il parametro $\tau$ non ha alcun indice, questo perchè l'effetto della covariate è uguale su tutti gli oggetti.
\end{itemize}
Nei vari modelli presentati precedentemente, veniva aggiunto il parametro $\beta_{i0}$. Tale parametro è l'intercetta che è una variabile di tipo \emph{object-specific}. Tale parametro spiegata la maggior parte della forza dell'oggetto, infatti le covariate possono essere viste come estensioni, contenenti effetti aggiuntivi dell'abilità dell'oggetto che non sono spiegati dall'intercetta. In tal senso, gli effetti della covariata possono aiutare a spiegare i risultati (imprevisti) di un soggetto che non possono essere completamente spiegati esclusivamente dall'intercetta.\\
Nella Sezione \ref{sez:4.3}, viene presentato l'\emph{order effect} degli oggetti in competizione. Invece di un \emph{order effect} globale $\delta$ , che è uguale per tutti gli oggetti, è possibile specificare l'\emph{order effect} specifico per ogni oggetto $\alpha_i$, quindi $\delta_i$.\\
la Tabella \ref{tab:type} vengono riassunti tutti i tipi di covariate e tutte le possibili parametrizzazioni che possono essere applicate.\\
Riassumendo il parametro abilità  $\gamma_{pi}$ di un oggetto $\alpha_i$ con \emph{i} = 1,....,n su un soggetto \emph{p}, \emph{p} = 1,.....,m non è altro che una combinazione lineare dei parametri precedentemente spiegati. Da ciò si ottiene il modello capace di utilizzare le covariate. Tale modello viene chiamato modello strutturato e fa parte dei generalized linear models (GLMs). Riprendendo il modello \ref{for:3.9} puo essere riadatto nella seguente forma
\begin{align}
	P(Y_{p(i,j)}\leq h) =  \frac{exp(\delta + \theta_{h} + \beta_{i0} - \beta_{j0} + x^T_{pi}\eta_i - x^T_{pj}\eta_j)}{1 + exp(\delta + \theta_{h} + \beta_{i0} - \beta_{j0} + x^T_{pi}\eta_i - x^T_{pj}\eta_j)} \label{for:4.9}
\end{align}

	\begin{table}[!htb]%
	
	\renewcommand{\arraystretch}{1.7}
	\centering
	\begin{tabular}{c c c c c}
		\hline	
		
		\textbf{Tipo di covariate} & \textbf{Tipo di effetto} & \textbf{$\gamma_{pi}$ =}& \textbf{$\gamma_{pj}$ =} & \textbf{$\gamma_{p(ij)}$ = $\gamma_{pi}$ $-$ $\gamma_{pj}$} \\	
		\hline			
		intercetta & object-specific & $\beta_{i0}$ & $\beta_{j0}$ & $\beta_{i0} - \beta_{j0}$\\
		order effect & globale & + $\delta$ &  & + $\delta$ \\
		order effect & object-specific &  + $\delta_i$ &  &  + $\delta_i$\\
		subject-specific $x_p$ & object-specific & + $x^T_p\beta_i$ & + $x^T_p\beta_j$ & + $x^T_p(\beta_i - \beta_j)$\\
		object-specific $z_i$ & globale & + $z^T_{i}\tau$ & + $z^T_{si}\tau$ & + ($z_{i} - z_{j})^T\tau$\\
		subject-object-specific $z_pi$ & globale & + $z^T_{pi}\tau$ & + $z^T_{pj}\tau$ & + ($z_{pi} - z_{pj})^T\tau$\\
		subject-object-specific $z_pi$ & object-specific & + $x^T_{pi}\eta_i$ & + $x^T_{pj}\eta_i$& + $x^T_{pi}\eta_i$ $-$ $x^T_{pj}\eta_j$\\
		\hline
		
		
	\end{tabular} \hbox{}
	
	\caption{La Tabella riassuntiva di tutti i tipi di covariate e di tutte le possibili parametrizzazioni applicabili.} \label{tab:type}
\end{table}





\begin{comment}
	Si necessita perciò di un modello che tenga conto anche di variabili esplicative inserite durante l'analisi. \\
	Sia x$_{i}$=($x_{i1},....x_{iK}$) il vettore di K variabili esplicative per un certo oggetto \textit{i} e $\beta$ = ($\beta_{1},....\beta_{P}$) il vettore dei pesi stimati per ogni variabile presente in x$_{i}$, allora si ha che il parametro abilità $\alpha_{i}$ di un certo oggetto \textit{i} è uguale a:
	
	\begin{center}
		\begin{large}
			$\alpha_{i}$ = $\beta_{1}x_{i1}$ + .... + $\beta_{P}x_{iP}$      con i=1,....,n
		\end{large}
		
	\end{center}
	
	Si ha quindi che il parametro abilità $\alpha_{i}$ per un certo oggetto \textit{i} è una combinazione lineare di variabili.\\
	Il modello è stato presentato per la prima volta da \autocite{springall1973response}; tale modello viene chiamato modello strutturato.\\
	
	Grazie a questo modello se vi sono covariate che hanno un legame con la variabile risposta, tanto da influenzarne l'esito con quest'ultima allora, sarà possibile inserirle nel modello. Nel caso calcistico tali covariate possono essere il possesso della palla o il numero di falli fatti.
\end{comment}
 
	