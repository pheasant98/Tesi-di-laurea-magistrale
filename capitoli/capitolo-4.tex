% !TEX encoding = UTF-8
% !TEX TS-program = pdflatex
% !TEX root = ../tesi.tex
%**************************************************************
\chapter{Modeling Paired Comparisons}
%\label{cap:archittettura del sistema AWMS}
%**************************************************************

\intro{Nel seguente capitolo verranno introdotti differenti modelli per la \textit{paired comparisons}, iniziando con il Bradley-Terry model versione standard fino a presentare tutte le sue estensioni usate per l'analisi trattata. }
TO DO

\section{Il Bradley-Terry Model}
Il Bradley-Terry model \autocite{bradley1952rank} asserisce che in una competizione tra due qualsiasi giocatori, detti player \textit{i} e player \textit{j} (i,j $\in$ \{1,...,n\}), la probabilità che \textit{i} sia preferito a \textit{j} è data dal rapporto tra $\alpha_{i}$ e $\alpha_{j}$, dove $\alpha_{i}$ e $\alpha_{j}$ sono parametri che rappresentano la cosiddetta abilità dei due giocatori. Il modello standard non considera covariate e in generale, non presta nessuna attenzione all'eterogeneità causata dai soggetti dei confronti.\\

Formalmente, sia Y$_{i,j}$ la variabile casuale associata al risultato della \emph{paired comparison} tra oggetti \textit{i} e \textit{j}, con \textit{j} > \textit{i} $\in$ \{1,...,n\}, dove nella forma più semplice, il modello dato è il seguente:
\begin{align} 
	P(i\succ j) = P(Y_{i,j} = 1) = \frac{exp(\alpha_{i} - \alpha_{j})}{1 + exp(\alpha_{i} - \alpha_{j})} \label{for:3.1} 
\end{align}

Il modello può essere alternativamente espresso in forma di logit lineare:

\begin{align}
		logit(i \succ j) =  log( \frac{P( i \succ j)}{P( j \succ i))} ) = log(\frac{exp(\alpha_{i})}{exp(\alpha_{j})}) = \alpha_i - \alpha_j 
	\end{align}

La risposta del modello rappresenta la probabilità che un certo oggetto \textit{i} è preferito rispetto su un altro oggetto \textit{j}, $i \succ j$. La variabile Y$_{i,j}$ essendo binaria può assumere solo due valori, Y$_{i,j}$ = 1 se l'oggetto \textit{i} è preferito sull'oggetto j e Y$_{i,j}$ = 0 viceversa. I parametri $\alpha_{n}$ come scritto precedentemente rappresentano l'attrattiva o la forza del loro corrispondente oggetto. Chiaramente questi parametri di abilità devono essere stimati dal modello attraverso la massima verosimiglianza. Infine si noti che vi è necessario un vincolo per identificare i parametri, ad esempio: il vincolo di somma $ \sum_{i=1}^{n} \alpha_{i} = 0 $ oppure il vincolo dell'oggetto di riferimento, $\alpha_{i} = 0$ per un oggetto \textit{i} $\in$ \{1, ..., n\}. Se il vincolo dell'oggetto di riferimento è usato, allora il valore dei parametri abilità degli altri oggetti \textit{j} sarà la differenza rispetto all'oggetto di riferimento \textit{i}.
\\

Si sottolinea inoltre che il modello precedentemente descritto è chiamato modello non strutturato e l'obbiettivo dell'analisi è di fare inferenza sul valore dei parametri abilità $\alpha_{n}$ per stilare una classifica finale di tutti gli oggetti.


\section{Il Bradley-Terry Model con ordered response categories}	
In molti contesti di comparazione tra oggetti, è possibile che sia richiesto di dare una scala di preferenza tra un oggetto e un altro. Supponiamo che due oggetti \textit{i} e \textit{j} siano confrontati e che la preferenza ora non sia più espressa i termini di: preferisco \textit{i} al posto di \textit{j} o viceversa ma, attraverso una scala di preferenza ad esempio, dando una forte preferenza a \textit{i} rispetto a \textit{j} o una leggera preferenza a \textit{i} rispetto a \textit{j} o non dando nessuna preferenza o preferendo leggermente \textit{j} rispetto a \textit{i} oppure preferire fortemente \textit{j} rispetto a \textit{i}. Dal modello descritto nella precedente sezione si passa da due classi di preferenza a cinque classi di preferenza.\\
Ovviamente il caso descritto è di interesse per le comparazioni calcistiche dato che non è sufficiente stimare la probabilità di vittoria o sconfitta ma deve essere obbligantemente preso in considerazione anche il pareggio come risultato. Si necessità perciò di un estensione del classico Bradley-Terry model descritto precedentemente.\\

Modelli che consentono un numero generale di categorie K, sono stati proposti da \autocite{tutz1986bradley} e da \autocite{bradley1952rank}, in particolare quest'ultimo mostrò come due modelli per l'analisi di dati ordinati possono essere adattati per le \emph{ordinal paired comparisons}.\\

Il primo modello è il \emph{cumulative link model} che sfrutta la rappresentazione della variabile casuale latente. In generale, sia H il numero di gradi della scala di preferenza e sia $Z_{i,j}$ una variabile continua casuale latente e siano $\theta_{1} $ < $\theta_{2}$ < .... < $\theta_{H-1}$ le soglie tale che Y$_{i,j} = h$ quando $\theta_{h-1} < Z_{i,j} < \theta_{h}$. Allora:
\begin{align}
	P(Y_{i,j}\leq h) =  \frac{exp(\theta_{h} + \alpha_{i} - \alpha_{j})}{1 + exp(\theta_{h} + \alpha_{i} - \alpha_{j})} \label{for:3.2.1}
\end{align}

con h $\in$ \{1,....,H\} che indica le possibili \emph{response categories}. I parametri $\theta_{h}$ rappresentano le cosiddette soglie per le singole \emph{response categories}, che determinano la preferenza per le specifiche categorie. In particolare, Y$_{i,j} = 1$ rappresenta la massima preferenza per un oggetto \textit{i} rispetto a un oggetto \textit{j}.\\
In generale vi è imposta una simmetria del modello in modo che valga: $P(Y_{i,j} = h) = P(Y_{i,j} = H - h + 1)$. È quindi necessario che le soglie siano ristrette a $\theta_{i}$ = -$\theta_{H-h}$ e se, H è dispari, $\theta_{H/2}$ = 0; per garantire che le probabilità siano simmetriche. Per garantire che le probabilità siano non negative per le singole \emph{response categories} vi è imposta la seguente limitazione: $-\infty$ = $\theta_{0} < \theta_{1} < ... < \theta_{H-1} < \theta_{H} = \infty$. Dato che la soglia per l'ultima categoria è fissata a $\theta_{H} = \infty$ allora vale che $P(Y_{i,j} \leq H)$ = 1. Si sottolinea che le soglie sono parametri che vanno stimate dai dati; inoltre la probabilità di una singola \emph{response category} può essere derivata dalla differenza tra categorie adiacenti cioè:
\begin{center}
	  $P(Y_{i,j} = k)$ = $P(Y_{i,j} \leq k + 1)$ - $P(Y_{i,j} \leq k - 1)$
\end{center}

Il modello delle \emph{adjacent categories model}, così come il modello Bradley-Terry, ha anche una rappresentazione logit lineare ed è il seguente:
\begin{align}
	logit(Y_{i,j}\leq h) =  \theta_{h} + \alpha_i - \alpha_j 
\end{align}

Il secondo modello invece proposto da \autocite{agresti1992analysis} è il \emph{adjacent categories model}. In questo caso il collegamento è applicato alle probabilità di risposte adiacenti, piuttosto che alle probabilità cumulative riducendosi così al modello Bradley-Terry quando sono consentite solo due categorie e al modello proposto da \autocite{davidson1970extending} quando sono consentite solo tre categorie.\\
Il modello proposto da \autocite{davidson1970extending} risulta essere adatto per l'analisi sulle partite di calcio.\\
Il \emph{adjacent categories model} è più semplice da interpretare rispetto ai \emph{cumulative link models} poiché l'odds ratio si riferisce a un determinato risultato anziché a raggruppamenti di risultati. \\
Perciò dal modello proposto da \autocite{davidson1970extending}, sia $\theta$ il parametro stimato dai dati che indica quanto è auspicabile la non preferenza, nel nostro caso il pareggio, allora:

\begin{align}
	P(Y_{i,j} = 2 | Y_{i,j} \not = 0) =  \frac{exp(\alpha_{i} - \alpha_{j})}{1 + exp(\alpha_{i} - \alpha_{j})}, \label{for:4.5}
\end{align}
	
\begin{align}
	P(Y_{i,j} = 1) =  \frac{\theta \sqrt{exp(\alpha_{i}) * exp(\alpha_{j})}}{exp(\alpha_{i}) + exp(\alpha_{j}) + \theta\sqrt{exp(\alpha_{i}) * exp(\alpha_{j})}}, 
\end{align}

\begin{align}	
	P(Y_{i,j} = 0 | Y_{i,j} \not = 1) =  \frac{exp(\alpha_{j} - \alpha_{i})}{1 + exp(\alpha_{j} - \alpha_{i})}\label{for:4.7}
\end{align}

Come si può vedere si è riportato la modellazione di tutti e tre i possibili risultati, con $\alpha_{n}$ che rappresenta la forza degli oggetti in comparazione da stimare dai dati. La modellazione della vittoria \hyperref[for:4.5]{(4.5)} e della sconfitta \hyperref[for:4.7]{(4.7)} dell'oggetto \textit{i} contro l'oggetto \textit{j} rimane uguale alla modellazione \hyperref[for:3.1]{(4.2)} descritta precedentemente. Diversamente per il pareggio dove viene aggiunto il parametro $\theta$. \\

\section{Il Bradley–Terry Model con variabili esplicative}
Fin ad ora è stato presentato un modello che valutasse il grado di preferenza per un oggetto \textit{i} rispetto a un oggetto \textit{j}, senza che considerasse nessuna variabile. Chiaramente tale modello risulta essere inutile per le nostre analisi, dato che siamo interessati a capire quali variabili possono influenzare il risultato della comparazione. Si necessita perciò di un modello che tenga conto anche di variabili esplicative inserite durante l'analisi. \\
Sia x$_{i}$=($x_{i1},....x_{iK}$) il vettore di K variabili esplicative per un certo oggetto \textit{i} e $\beta$ = ($\beta_{1},....\beta_{P}$) il vettore dei pesi stimati per ogni variabile presente in x$_{i}$, allora si ha che il parametro abilità $\alpha_{i}$ di un certo oggetto \textit{i} è uguale a:

\begin{center}
	\begin{large}
	 $\alpha_{i}$ = $\beta_{1}x_{i1}$ + .... + $\beta_{P}x_{iP}$      con i=1,....,n
	\end{large}

\end{center}

Si ha quindi che il parametro abilità $\alpha_{i}$ per un certo oggetto \textit{i} è una combinazione lineare di variabili.\\
Il modello è stato presentato per la prima volta da \autocite{springall1973response}; tale modello viene chiamato modello strutturato.\\
 
Grazie a questo modello se vi sono covariate che hanno un legame con la variabile risposta, tanto da influenzarne l'esito con quest'ultima allora, sarà possibile inserirle nel modello. Nel caso calcistico tali covariate possono essere il possesso della palla o il numero di falli fatti.


\subsection{Il Bradley–Terry Model con effetto partite in casa}
Nel modello descritto nella sezione 2.2, si era scritto che, era necessario imporre la simmetria tra le categorie di risposta. Purtroppo la simmetria imposta risulta essere non adeguata in alcuni contesti, tra questi vi è anche il calcio; poiché l'ordine dei oggetti conta. Infatti nel calcio la prima squadra che viene indicata tra le due squadre, è quella che gioca in casa, dove teoricamente dovrebbe avere un vantaggio sull'avversario. Perciò, il presupposto che le categorie di risposta siano simmetriche non vale più. \\
Un possibile modello riadattato al problema esposto è il seguente:

\begin{align} 
	P(i\succ j) = P(Y_{i,j} = 1) = \frac{exp(\delta + \alpha_{i} - \alpha_{j})}{1 + exp(\delta + \alpha_{i} - \alpha_{j})} \label{for:3.8} 
\end{align}

Il qual'è il modello \hyperref[for:3.1]{(4.1)} riadatto e da cui possiamo derivare il modello \hyperref[for:3.2.1]{(4.3)} riadatto che è il seguente:

\begin{align}
	P(Y_{i,j}\leq h) =  \frac{exp(\delta + \theta_{h} + \alpha_{i} - \alpha_{j})}{1 + exp(\delta + \theta_{h} + \alpha_{i} - \alpha_{j})} \label{for:3.9}
\end{align}

Come si può vedere il vantaggio di giocare in casa, in generale l'effetto d'ordine; viene trattato come una variabile esplicativa. Infatti se $\delta$ > 0 allora viene attribuito un vantaggio all'oggetto \textit{i}, nel contesto calcistico significa che gioca in casa; aumentando la probabilità che vinca il confronto o nel caso di \emph{ordered response categories}, di avere un risultato superiore rispetto all'oggetto \textit{j}. Chiaramente il peso di $\delta$ deve essere stimato dai dati.\\

Il modello \hyperref[for:3.8]{(4.8)} cosi come il modello \hyperref[for:3.9]{(4.9)} , hanno anche una rappresentazione logit lineare e sono le seguenti:\\

Per \hyperref[for:3.8]{(3.8)}

\begin{align}
	logit(i \succ j) =  \delta + \alpha_i - \alpha_j 
\end{align}

Per \hyperref[for:3.9]{(3.9)}

\begin{align}
	logit(Y_{i,j}\leq h) =  \delta + \theta_{h} + \alpha_i - \alpha_j 
\end{align}
	